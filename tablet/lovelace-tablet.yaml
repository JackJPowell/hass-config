button_card_templates:
  !include_dir_merge_named button_card_templates

views:
  - type: custom:grid-layout
    path: home
    title: Home
    layout:
      #default
      margin: 0 
      grid-gap: var(--custom-layout-card-padding)
      grid-template-columns: repeat(4, 1fr) 0
      grid-template-rows: 0 repeat(2, fit-content(100%)) 0fr
      grid-template-areas: |
        "sidebar  .           .       .       ."
        "sidebar  home        media   living  ."
        "sidebar  playing     patio   us      ." 
        "sidebar  footer      footer  footer  ."
      mediaquery:  
        #phone
        "(max-width: 800px)": 
          grid-gap: calc(var(--custom-layout-card-padding) * .6)
          grid-template-columns: 10px repeat(2, 1fr) 0
          grid-template-rows: 0 repeat(5, fit-content(100%)) 0fr
          grid-template-areas: |
            ".  .           .     "
            ".  home        living"
            ".  media       patio "
            ".  playing     us    "
            ".  footer      footer"
        #portrait
        "(max-width: 1200px)":
          grid-gap: var(--custom-layout-card-padding)
          grid-template-columns: repeat(3, 1fr) 0
          grid-template-rows: 0 repeat(3, fit-content(100%)) 0fr
          grid-template-areas: |
            "sidebar  .           .       ."
            "sidebar  home        living  ."
            "sidebar  media       patio   ."
            "sidebar  playing     us      ."
            "sidebar  footer      footer  ."
            "sidebar  .           .       ."
    cards:

      #extra_styles fix, do not remove
      #also warn if theme is not set

      - type: custom:button-card
        view_layout:
          grid-area: 1 / 2 / 2 / 5
        name: SET THEME TO "tablet" IN PROFILE
        tap_action:
          action: navigate
          navigation_path: /profile
        styles:
          card:
            - display: >
                [[[
                  return hass.themes.theme === 'tablet'
                      ? 'none'
                      : 'initial';
                ]]]
          name:
            - z-index: 1
            - overflow: visible
            - color: red
            - font-weight: bolder
            - font-size: xxx-large
            - background: yellow

      #################################################
      #                                               #
      #                    SIDEBAR                    #
      #                                               #
      #################################################

      - type: vertical-stack
        view_layout:
          grid-area: sidebar
        cards:
          - type: custom:button-card
            entity: sensor.template_sidebar
            template: sidebar
          - type: 'custom:button-card'
            name: Home
            styles:
              icon:
                - width: '8%'
              grid:
                - grid-template-areas: '"n i"'
            layout: icon_name
            icon: mdi:home2
            tap_action:
              action: navigate
              navigation_path: /lovelace-tablet/home?hide_header
            card_mod:
              style:
                .: |
                  #container {
                    padding: 12px;
                    background: white;
                    margin: 0px 20px;
                    border-radius: 22px;
                    color: black;
                  }
                  #container #name {
                    justify-self: start;
                    margin: 0px 5px;
                  }
          - type: 'custom:button-card'
            name: Lights
            styles:
              icon:
                - width: '8%'
              grid:
                - grid-template-areas: '"n i"'
            layout: icon_name
            icon: fas:lightbulb
            tap_action:
              action: navigate
              navigation_path: /lovelace-tablet/lights?hide_header
            template:
              - sidebar_card

          - type: 'custom:button-card'
            name: Media
            layout: icon_name
            icon: fas:photo-video
            tap_action:
              !include popup/home_media.yaml
            template:
              - sidebar_card
          - type: 'custom:button-card'  
            name: Patio
            layout: icon_name
            icon: mdi:string-lights
            tap_action:
              action: navigate
              navigation_path: /lovelace-tablet/patio?hide_header
            template:
              - sidebar_card
          - type: 'custom:button-card'
            name: Timers
            layout: icon_name
            icon: fas:clock
            tap_action:
              action: navigate
              navigation_path: /lovelace-tablet/timers?hide_header
            template:
              - sidebar_card
          - type: weather-forecast
            entity: weather.home
            show_forecast: true
            show_current: true
            name: Home
            card_mod:
              style:
                .: |
                  .state {
                    max-width: 104px;
                  }
                  :host([narrow]) .state {
                    font-size: 16px !important;
                    width: 300px;
                  }
                  ha-card { 
                    box-shadow: none; 
                    background: rgb(10 73 104 / 0%) !important;
                    margin-top: 4vh;
                  }

      #################################################
      #                                               #
      #                  Home                         #
      #                                               #
      #################################################

      - type: grid
        title: Home
        view_layout: 
          grid-area: home 
        columns: 2  
        cards:

          - type: custom:button-card
            entity: cover.garage_door  
            name: Garage
            template: 
              - garage
              - icon_garage

          - type: custom:button-card  
            entity: light.all_lights 
            name: All Lights
            tap_action:
              !include popup/home_lights.yaml
            template:
              - base
              - icon_hue
              - light
                 
          - type: custom:button-card
            entity: timer.alexa1
            name: Timer
            template:
              - base 
              - icon_timer 

          - type: conditional   
            conditions:
              - entity: input_boolean.trash_is_due
                state: "on"
            card:
              type: custom:button-card
              entity: sensor.waste_connections_pickups  
              template:
                - base
                - trash  
                - icon_trash 

          - type: conditional
            conditions:
              - entity: sensor.meater_probe_cook_state 
                state: 
                  - Started
                  - Configured 
            card:   
              type: custom:button-card 
              entity: timer.meater  
              name: Cook Timer
              template:
                - base
                - meater
                - icon_thermostat_quarter

      #################################################
      #                                               #
      #                    Media                      #
      #                                               #
      #################################################

      - type: grid
        title: Media Room
        view_layout: 
          grid-area: media
        columns: 2
        cards:
 
          - type: custom:button-card
            entity: light.media_room_main_lights
            name: Lights
            template: 
              - light
              - icon_spot 

          - type: custom:button-card
            entity: sensor.ps5_activity
            name: PS5 
            template:
              - base
              - conditional_media
              - icon_ps5 
              - loader
              - harmony_media 
 
          - type: custom:button-card
            entity: cover.left_shade
            name: Shades
            double_tap_action: 
              !include popup/media_shades.yaml
            template:
              - shades
              - icon_blinds
            tap_action:
              action: call-service  
              service: cover.toggle
              service_data:
                entity_id: cover.media_room_shades 

          - type: custom:button-card
            entity: switch.harmony_watch_plex
            name: Watch Plex
            template:
              - base  
              - icon_plex   
              - loader 
              - harmony_media 

      #################################################
      #                                               #
      #                    Living                     #
      #                                               #
      #################################################

      - type: grid
        title: Living Room
        view_layout:
          grid-area: living
        columns: 2
        cards:

          - type: custom:button-card
            entity: media_player.living_room_speaker
            name: Sonos One
            template: 
              - base 
              - icon_spotify
              - conditional_media
            variables: 
              circle_input: >
                [[[
                  if (entity) {
                      return entity.state === 'playing'
                          ? Math.round(entity.attributes.volume_level)
                          : 0;
                  }
                ]]]
              circle_input_unit: '%'

          - type: custom:button-card
            entity: climate.thermostat
            name: A/C
            tap_action:
              action: more-info 
            template:
              - base
              - icon_climate
              - circle
            variables:
              circle_input: >
                [[[
                  if (entity) {
                      return entity.state === 'cool'
                          ? Math.round(entity.attributes.temperature).toString()
                          : Math.round(entity.attributes.current_temperature).toString();
                  }
                ]]]
              circle_input_unit: '°F'

          - type: custom:button-card
            entity: switch.living_room_watch_apple_tv
            name: Watch TV
            template:
              - base  
              - icon_plex   
              - loader 
              - harmony_media 

          - type: custom:button-card
            entity: camera.camera_attic
            name: Attic
            state_display: "Monitoring"
            tap_action:
              !include popup/camera_attic.yaml
            template:
              - base  
              - icon_unifi_cam

      #################################################
      #                                               #
      #                     Playing                   #
      #                                               #
      #################################################

      - type: grid
        title: On Now
        view_layout:
          grid-area: playing
        columns: 1
        cards: 

          - type: custom:swipe-card
            parameters:
              speed: 550
              spaceBetween: 40
              threshold: 5
            cards:

              - type: horizontal-stack
                cards:

                  - type: conditional
                    conditions:
                      - entity: media_player.living_room_speaker
                        state_not: playing

                      - entity: media_player.sonos_roam
                        state_not: playing

                      - entity: media_player.plex_on_android_tv
                        state_not: playing

                      - entity: media_player.plex_on_apple_tv
                        state_not: playing

                      - entity: sensor.ps5_activity
                        state_not: playing
                    card:
                      type: custom:button-card
                      entity: sensor.plex_recently_added
                      name: Recently Added
                      tap_action:  
                        action: none
                      styles:
                        card:
                          - padding: 2%;
                          - border-radius: 20px;
                      template:
                        - conditional_media

                  - type: conditional
                    conditions:
                      - entity: media_player.living_room_speaker
                        state: playing
                    card:
                      type: custom:button-card
                      entity: media_player.living_room_speaker
                      template:
                        - conditional_media

                  - type: conditional
                    conditions:
                      - entity: sensor.ps5_activity
                        state: playing
                    card:
                      type: custom:button-card
                      entity: sensor.ps5_activity
                      template:
                        - conditional_media

                  - type: conditional
                    conditions:
                      - entity: media_player.sonos_roam
                        state: playing
                    card:
                      type: custom:button-card
                      entity: media_player.sonos_roam
                      template:
                        - conditional_media

                  - type: conditional
                    conditions:
                      - entity: media_player.plex_on_android_tv
                        state: playing
                    card:
                      type: custom:button-card
                      entity: media_player.plex_on_android_tv
                      template:
                        - conditional_media

                  - type: conditional
                    conditions:
                      - entity: media_player.plex_on_apple_tv
                        state: playing
                    card:
                      type: custom:button-card
                      entity: media_player.plex_on_apple_tv
                      template:
                        - conditional_media

              - type: grid
                columns: 2
                cards:

                  - type: custom:button-card
                    entity: media_player.plex_on_apple_tv
                    name: Apple TV
                    template:
                      - media
                      - icon_apple_tv

                  - type: custom:button-card
                    entity: media_player.plex_on_android_tv
                    name: Android TV
                    template:
                      - media
                      - icon_apple_tv 

                  - type: custom:button-card
                    entity: media_player.sonos_roam
                    name: Sonos Roam
                    template:
                      - media 
                      - icon_sonos

                  - type: custom:button-card
                    entity: media_player.living_room_speaker
                    name: Sonos
                    template:
                      - media
                      - icon_sonos

      #################################################
      #                                               #
      #                    Patio                      #
      #                                               #
      #################################################

      - type: grid
        title: Patio
        view_layout:
          grid-area: patio
        columns: 2
        cards:
          - type: custom:button-card
            entity: light.patio_lights
            name: Patio Lights
            template:
              - light
              - icon_spot

          - type: custom:button-card
            entity: fan.ceiling_fan
            tap_action:
              action: call-service
              service: script.patio_fan_high
              data: {}
              target: {}
            name: Fans
            double_tap_action:
              !include popup/patio_fans.yaml
            template:
              - base
              - icon_fan2
              - loader

          - type: custom:button-card
            entity: media_player.sonos_roam
            name: Sonos Roam
            double_tap_action:
              !include popup/studio_monitorer.yaml
            template:
              - icon_spotify
              - conditional_media
            variables:
              circle_input: >
                [[[
                  if (entity) {
                      return entity.state === 'playing'
                          ? Math.round(entity.attributes.volume_level)
                          : 0;
                  }
                ]]]
              circle_input_unit: '%'
               
          - type: custom:button-card
            entity: binary_sensor.dog_door
            name: Dog Door
            template: 
              - base
              - icon_dog

      #################################################
      #                                               #
      #                     Us                        #
      #                                               #
      #################################################

      - type: grid
        title: Us
        view_layout:
          grid-area: us
        columns: 2
        cards:

          - type: custom:button-card
            entity: person.jack
            name: Jack
            tap_action:
              !include popup/home_jack.yaml
            variables:
              retain: sensor.jack_last_changed
            template:
              - person
              - circle

          - type: custom:button-card
            entity: person.jacqueline
            name: Jacqueline
            tap_action:
              !include popup/home_jacqueline.yaml
            template:
              - person
              - circle 

          - type: custom:button-card 
            entity: input_boolean.announcement_compete
            state_display: Play
            tap_action:
              action: call-service
              service: automation.trigger
              service_data:
                entity_id: automation.morning_annoucement
                skip_condition: true
            name: Good Morning
            template:
              - base
              - icon_away 

          - type: custom:button-card
            entity: script.bedtime
            name: Goodnight
            template:
              - base
              - icon_bed

      #################################################
      #                                               #
      #                    FOOTER                     #
      #                                               #
      #################################################

      - type: horizontal-stack
        view_layout:
          grid-area: footer
        cards:

          - type: custom:button-card
            name: >
              <ha-icon icon="mdi:nas"></ha-icon> NAS
            tap_action:
              !include popup/footer_nas.yaml
            triggers_update:
              - update.nas_dsm_update
              - sensor.nas_volume_1_status
              - binary_sensor.nas_security_status
              - sensor.disk_use_percent
            variables:
              notify: >
                [[[
                  let id = this._config.triggers_update;
                  if (id.every(e => states[e]))
                      return states[id[0]].state === 'on'
                          ? 1
                          : states[id[1]].state === 'background_scrubbing' ||
                            states[id[2]].state === 'on' ||
                            parseFloat(states[id[3]].state) >= 85;
                ]]]
            template: footer

          - type: custom:button-card
            entity: sensor.template_updates
            name: >
              <ha-icon icon="mdi:arrow-up-bold-circle-outline"></ha-icon> Updates
            tap_action:
              !include popup/footer_updates.yaml
            triggers_update:
              - sensor.hacs
              - sensor.template_updates
            variables:
              notify: >
                [[[
                  let id = this._config.triggers_update;
                  //todo - add docker_hub sensor back
                  if (id.every(e => states[e])) {
                      let hacs = parseInt(states[id[0]].state),
                          //other = parseInt(states[id[1]].state),
                          installed = hass.config.version;
 
                      if (Number.isInteger(hacs))
                          return hacs; //+ (installed !== latest ? 1 : 0);
                  }
                  return 0;
                ]]]
            template: footer

          - type: custom:button-card
            name: >
              <ha-icon icon="mdi:robot-vacuum-variant"></ha-icon> Roomba
            tap_action:
              !include popup/footer_vacuum.yaml
            triggers_update:  
              - sensor.date
            variables:
              notify: >
                [[[
                  let id = states['sensor.morty_last_clean_end'];
                  if (id) return (Date.now() - Date.parse(id.state)) > 6048e5;
                ]]]
            template: footer

          # - type: custom:button-card
          #   name: >
          #     <ha-icon icon="mdi:chart-line-variant"></ha-icon> Historik
          #   tap_action:
          #     !include popup/footer_history.yaml
          #   template: footer

          - type: custom:button-card
            name: >
              <ha-icon icon="mdi:tablet"></ha-icon> Tablet
            tap_action:
              !include popup/footer_tablet.yaml
            variables:
              notify: >
                [[[
                  let id = states['binary_sensor.galaxy_tab_a_plugged_in'];
                  if (id) return id.state === 'off';
                ]]]
            template: footer

          - type: custom:button-card
            name: >
              <ha-icon icon="mdi:router-wireless"></ha-icon> Unifi
            #tap_action:
              #!include popup/footer_router.yaml
            #variables:
              # notify: >
              #   [[[
              #     let id = this._config.triggers_update;
              #     if (id.every(e => states[e]))
              #         return states[id[0]].state === 'on'
              #             ? 1
              #             : states[id[1]].state === 'off';
              #   ]]]
            template: footer 

          - type: custom:button-card
            name: >
              <ha-icon icon="mdi:raspberry-pi"></ha-icon> RPi
            tap_action:
              !include popup/footer_rpi.yaml
            variables:
              notify: >
                [[[
                  let id = states['binary_sensor.rpi_ping'];
                  if (id) return id.state === 'off';
                ]]]
            template: footer

  - type: custom:grid-layout
    path: timers
    title: Timers
    layout:
      #default
      margin: 0 
      grid-gap: var(--custom-layout-card-padding)
      grid-template-columns: repeat(4, 1fr) 0
      grid-template-rows: 0 repeat(2, fit-content(100%)) 0fr
      grid-template-areas: |
        "sidebar  .           .       .       ."
        "sidebar  home        media   living  ."
        "sidebar  playing     patio   us      ."
        "sidebar  footer      footer  footer  ."
      mediaquery:  
        #phone
        "(max-width: 800px)":
          grid-gap: calc(var(--custom-layout-card-padding) * .6)
          grid-template-columns: 10px repeat(2, 1fr) 0
          grid-template-rows: 0 repeat(5, fit-content(100%)) 0fr
          grid-template-areas: |
            ".  .           .     "
            ".  home        living"
            ".  media       patio "
            ".  playing     us    "
            ".  footer      footer"
        #portrait
        "(max-width: 1200px)":
          grid-gap: var(--custom-layout-card-padding)
          grid-template-columns: repeat(3, 1fr) 0
          grid-template-rows: 0 repeat(3, fit-content(100%)) 0fr
          grid-template-areas: |
            "sidebar  .           .       ."
            "sidebar  home        living  ."
            "sidebar  media       patio   ."
            "sidebar  playing     us      ."
            "sidebar  footer      footer  ."
            "sidebar  .           .       ."
    cards:
      - type: custom:button-card
        view_layout:
          grid-area: 1 / 2 / 2 / 5
        name: SET THEME TO "tablet" IN PROFILE
        tap_action:
          action: navigate
          navigation_path: /profile
        styles:
          card:
            - display: >
                [[[
                  return hass.themes.theme === 'tablet'
                      ? 'none'
                      : 'initial';
                ]]]
          name:
            - z-index: 1
            - overflow: visible
            - color: red
            - font-weight: bolder
            - font-size: xxx-large
            - background: yellow

      #################################################
      #                                               #
      #                    SIDEBAR                    #
      #                                               #
      #################################################

      - type: vertical-stack
        view_layout:
          grid-area: sidebar
        cards:
          - type: custom:button-card
            entity: sensor.template_sidebar
            template: sidebar
          - type: 'custom:button-card'
            name: Home
            layout: icon_name
            icon: mdi:home
            tap_action:
              action: navigate
              navigation_path: /lovelace-tablet/home?hide_header
            template:
              - sidebar_card
          - type: 'custom:button-card'
            name: Lights
            styles:
              icon:
                - width: '8%'
            layout: icon_name
            icon: fas:lightbulb
            tap_action:
              action: navigate
              navigation_path: /lovelace-tablet/lights?hide_header
            template:
              - sidebar_card

          - type: 'custom:button-card'
            name: Media
            layout: icon_name
            icon: fas:photo-video
            tap_action:
              !include popup/home_media.yaml
            template:
              - sidebar_card
          - type: 'custom:button-card'  
            name: Patio
            layout: icon_name
            icon: mdi:string-lights
            tap_action:
              action: navigate
              navigation_path: /lovelace-tablet/patio?hide_header
            template:
              - sidebar_card
          - type: 'custom:button-card'
            name: Timers
            styles:
              icon:
                - width: '12%'
              grid: 
                - grid-template-areas: '"n i"'
            layout: icon_name
            tap_action:
              action: navigate
              navigation_path: /lovelace-tablet/timers?hide_header
            card_mod:
              style:
                .: |
                  #container {
                    padding: 12px;
                    background: white;
                    margin: 0px 20px;
                    border-radius: 22px;
                    color: black;
                  }
                  #container #name {
                    justify-self: start;
                    margin: 0px 5px;
                  }

          - type: weather-forecast
            entity: weather.home
            show_forecast: true
            show_current: true
            name: Home
            card_mod:
              style:
                .: |
                  .state {
                    max-width: 104px;
                  }
                  :host([narrow]) .state {
                    font-size: 16px !important;
                    width: 300px;
                  }
                  ha-card { 
                    box-shadow: none; 
                    background: rgb(10 73 104 / 0%) !important;
                    margin-top: 4vh;
                  }

      - type: grid
        title: Kitchen Timer
        view_layout:
          grid-area: home
        columns: 1
        cards: 
          - type: custom:button-card
            entity: timer.alexa1
            show_name: false 
            template:
              - base 
              - icon_timer
            card_mod:
              style:
                .: |
                  #state {
                    font-size: 4em !important;
                  }

      - type: grid
        title: Second Timer
        view_layout:
          grid-area: media
        columns: 1
        cards: 
          - type: custom:button-card
            entity: timer.alexa2
            show_name: false 
            template:
              - base 
              - icon_timer
            card_mod:
              style:
                .: |
                  #state {
                    font-size: 4em !important;
                  }

      - type: grid
        title: Third Timer
        view_layout:
          grid-area: living
        columns: 1
        cards: 
          - type: custom:button-card
            entity: timer.alexa3
            show_name: false 
            template:
              - base 
              - icon_timer
            card_mod:
              style:
                .: |
                  #state {
                    font-size: 4em !important;
                  }

          - type: conditional
            conditions:
              - entity: sensor.meater_probe_cook_state 
                state: 
                  - Started
                  - Configured 
            card:   
              type: custom:button-card 
              entity: timer.meater  
              name: Cook Timer
              template:
                - base
                - meater
                - icon_thermostat_quarter
              card_mod:
                style:
                  .: |
                    #state {
                      font-size: 4em !important;
                    }